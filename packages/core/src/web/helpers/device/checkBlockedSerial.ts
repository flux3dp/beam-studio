import alertCaller from '@core/app/actions/alert-caller';
import { axiosFluxId } from '@core/helpers/api/flux-id';
import i18n from '@core/helpers/i18n';

import { sha256 } from '../sha';

const BLOCKED_SERIALS = [
  'e3ce652064e41fad20fa594b23d0710b37edb52d342217245f0d50319ee3259c',
  'f5171c5c1917f4703db293febd803feb9b97c35b84b309136a3e11b036d6c6c6',
  '6613b09b1c7f8a8a99dad1037200251de9d23dedc8c560c0ff24995cba95fd52',
  'cd8616a95cd960a7b39dfa5fa9b783a99f76623c547d567ffae62cdefad316bd',
  '0b127c88dd0846077398ceecaf4ceb5e830f55a54fd4b6837a9a576aa53f8b21',
  'b909240fb338193564ab93fe87f28d790efeec260f1a3519448cb4ad8cd6a01b',
  '863b58086ffc55f61241731004e5481d9a21b2766e4c0ed98082c34bcb0375fb',
  'f791e38606f6873afaf585d8c14832d7d801ee757ea3415bf6ac18d3e804903b',
  '74d0d503e9237306a84c2b8a1e367835f22eab708082c6f448df1bf970dd5762',
  '9c42b9b1856351deffd59840cbefe31422f4f037b4e8b077f7660996f193f64a',
  '2d0598e4537cc696d7da29dd237710bc85d3ae82d48ce2fbef94497233ab96f5',
  '0914bfbe7cf56437a210609c76076f8159bc9ab26dfcefd57a378a65cee9fa4d',
  '4b0294b9843b7420fd0b058ed492d6aa72591bf1f00edc7b43b98c7009c09ac9',
  'e31d2585f69bed0e851f4bea6a7f6b38ec7a85b776430e5ee1539e205bd87e5e',
  '3345f016e5329442df5ade42ac96c70517ce7b9fa44f2e56810bc1870be33670',
  'd45456bc547573d7a8a64ab620469f6d6afbb040e7f080f4700f3c478708dda5',
  '79bf610be9397785fef9d2c4c1c9b1813ea1f24513f56bbf03d914fea5e545ac',
  'e8540a2a34f261580d2f483fcea5903a2081c7b494bd39275cffd4a5ba00233a',
  '5a326bb4e5afddd291541214517e454d90ab1bc5da08ea65579b9d3a0bbdd581',
  'ff84726f3b4dab3e90afe63f8256d7a47f0b16950c463db6b7ac1315a7c2d857',
  'd36b441217ff461e4f74adea97a1e27373255afacb87e2cd811139dc5beea0ea',
  '76d2b9eb909ace2cefe3b5e765dc8993b7906af039d2c6438daa9c7af4fd6469',
  'e5513ad28387b3bac38d3e0a20d6607a51fcbea1dae2ef1c93e4ac7b8073e152',
  'f275491cddada2ada413b3a3891bfcf3c8e03d12ba7e662055752d0557d23456',
  '141b0fc90daf63f9bc0aa015f97222b21c74d2b084e14ed7e71ce5cf1c69052a',
  '0bc831fd2c296c758a8d1ec2df018e350b2be368c2f539ba49c1f14235a0aa61',
  '0d19b458c8c71cdbbed7b3d6b271ad140c8874f345aedd2e8993c2db6cf5a938',
  '3df91c5f7e267db885cef63e84bd61a20d5931511f64c40076504b7ed3af8573',
  'f924f4d1f5594ab1720921600269215b34ff47ef3d9a1c3a8d489db7cd22d334',
  '9befbf0e79a6974f5c0a1766988370999d940781a505a0422308d950799d701b',
  '139cf314928e2bff35b236f7b4047a20e6a3de3631ca7fef430400a9a316d190',
  '1c14733dfbc834a51c50dd54660235b82311a113670b4e25c192eea7ebfa6c52',
  '3ff3fb95fcd765421a9c1c504a0bbb0b8c2639c52edc4fba5b1f119c0b6ad77d',
  'fff32d18c67fba71c180452fcaa638b7fa32aabac8804c14558caaaaa6182ff5',
  '2e58ea65fa4678cf3afc9fed952f0685dbf321c5d177d61b46a856b783a7531e',
  '6c3fc6cc51ff9630329f5560472a878a20e106309550a887a9e79e52938643a3',
  '0612b2aeca7c5511797e5ade783c9afbf06645c7d70bdf052afa9f9ebfd5cab3',
  '4da8bb2b8733c543669acbd4ac50cabe339c17b3a0898611c9f670509e4703ce',
  '0ed795fcf87d0291270f7b276840ac3c30446d86bf7862b430f926809a31c069',
  '6b7598cff0c9039f6311947513e816509b5d6dce330a3f3a28e980c5c9c691aa',
  'a25e4ef7af0dd5474c54ab21a354fb0c4988f9adebdae40e9143eb111724e32b',
  '86c5370784ca7924505404b505328b9b0389d2dc926fbac745a314b499833cd2',
  '82bc6e3259a9d5623f832ea78e1fee022272d8fa517a8352e0695120777083a8',
  '1ca89391d2a506a36f2924fa962b3089884422441a01031ccae2dd538829ff86',
  'bebd7e847c4199d6036fb46f4a5e38835cf01f2d76f07160fc9a0528e1742315',
  '3d7e5bba902c27ef226da56ed45513a905f1912533a6a9a56359307c84349403',
  'b527570c459cadd41522a0545750bb7b09f33e1e76157d53340b63b8f9bd13db',
  '8dddfc4579ad5ffa4d7d72b45ba1f7cc19f61812adc289b3c350039782ea81c3',
  'e693610a5f2a60a89a54eba0d54ffbacaa30a6eed3255cf3c78f8a3f2ad90539',
  '4426a8fe66778b4af9634b0952f7d46c3a19d927f3b38d7aaaea40961f32af0b',
  'f89191ee51fca11b672f96fc25e44b9fefc529258fec3472da311f05fedd5c2d',
  '334ec99543ad28d8134056b86f1e0a298ca6b2d54ed6567355e76b273bd1d9e7',
  '517c2deadf1f8c3e85fda9a9854abe66074d48458cbe377dbf693fbeedd1803f',
  '2272da6d9fc2d88d81befdd834309d6925c8fbf9ecef1dac33eaae1f5b6472bc',
  '4895a9f09cbc9a2803ef9a9d15536ab20d440a4a8d9e14e857ac2b0c1356f6f1',
  '1e2e51fb8bb05280b436aa68544c3d71002fe84f78f94a108453bd4f373de69d',
  'c78280d9172ef8f633c17b8fdf9dff120373f870ffbf887c4a53d9f4a0baf29d',
  'be2493e2fe0c633f65c98dc7e1d5c204f368d4bcc7ac7dae0a7a352ba4c14ae1',
  'a8c5ff993fc79d7f73d7d4ddf66a19b3d2ba80ee2f7a328329961ddb284c0287',
  '6a7f2cab2289d4cd5a1af8e482efd2177d7d0f579aba0fe3f054b85292d71b14',
  '3713320b5f23dfc0a4431d9b6377c20df68cbf984943c7dea03bcd5b5cdc9c1c',
  'd3b2b9dc49993487cf69e36bd7c686e385134f37e075b65ff136811c46f6869c',
  '7a8a984b9aa9a86e6a8f09df511450868ee9f3a8d118f4168e5f9cd9b86156f3',
  'a83d5c07a432a6048a92cd03788d387216e77dfacff79c272c51633a069a4765',
  'dd9f7ae49ff53ded9b9f1b3cf1661b80370c81d530fcad8ff960b2e7aeddedb4',
  '268cdc3ad0b29c0d768ae3875714ec692a60d7b2c8d6245a210c11c0de215d5e',
  'a260c8bb7b1108fe588972f167f2f8eacd625b2ce6dda52c9ae976ddb53efcf4',
  '41d88ba82d7e3bbb9aad3d643405411e8f137d2b58651c9ed0dfd6ff5f8ae87c',
  '52f2924d2c396c8c07544b83d7c65f2409bd9a87ed3c25312fdcb88335ed2a5d',
  'a35221e8c9fb18c439c6f917c5c8f14c4020a8c8ec0a15d65edadc2afd159230',
  'd7a5b3fe2b560a1e1fcbc707ef04b0d2c0d38118d127a197a2be8878d1855d07',
  'f0c5e652851d8920dd4686525cae6c77e3c2945810c41bf6dba655e183fb389c',
  '941ad2f1438f305783aa67829929dc3704f6ff69d513dbaed2e48c5d25dedb72',
  'f8885e281175edcd965a5b908a57d6d1e08ad3f99d111fd799f453faa07f5a46',
  '0972cb986283075ff2d53a33d03a19731c101034ed39322737ee6a466a2d7f34',
  'b803fa73be900db87a873c733f31ca4717eddc55b96933a47dd5a31e99c0aa75',
  '1cbbad7f669143b41af85afe57fb67bea03e83fb6cb03051a7c4f86b7e393e21',
  'fdd1312e994e411b048195f84f7e4b8db8c4dcbb3dec50ba6dfafce985b5ccc1',
  '33a1d29c0dc0b124870b4f3360f8347c5bbb0d3afe82cbf6e134ebd1d24b0f53',
  'f934fa71eed25856e21f0f1957c2b5047cf3fef538b64fa44b883e63853ac30b',
  'fd649af45692c80ab6004c1592f508d2094ec7eef7ec54f40e3f1268dd466b9d',
  '31487237d3b6ea4ec3fd4b46d5ac6a484c1fde82d9afe46b102be08f9123f631',
  '975b68ced637d9b9ec8496f8f6a215f52b434b17bae7b0c2ef924724d3428797',
  'd84e166cfd318859d3a14010da9f053647a2affdfa68dd937d85377b2072fe7b',
  '79e8fd3415ed51bf13d39063c29138e3b858ffcf13da5548bead3d535620c71e',
  '38cd29e10aa64b74e2ab4004b8d784731e4f5ad3d575ce9165ae9d7a7b41ceba',
  '9b8c7a301bf6fde19e405ae5a7e6f65f8d1b85ff842ecac498d68b6decaa64fd',
  '93352b919f565d324cfb38d7e3a777410b9ddae1484d9bd18a2a59fddf917331',
  '541b6c1ff5cf5ca887b2504ce70116b6e57993e8e768c3726d8e203006e1bab3',
  'd6e31a4c3f15eb10b4e1599f91e35c59ca054b7a1a68b872cd4aa9351a78f3f5',
  'eeff28125a9c454116546d03481f10dbd02a0e9ed49e4d7c632d78278e112fb4',
  'e0abcb661521bd8892ee7b270fe2c5cddfe47cdf0518538fb1c9770e783c4e84',
  '33e2143e8d654c29d530ea7cbce5b9d6f5112322e612664b93bc9781fdce8398',
  'a7052a0b13647fdfa8076253b4c355225cbdd56b9cc73990ae5c161229268d3f',
  '30f58b8667de67a3c50ed7644b715ced822491d5fbbe840683312a35b22236ab',
  '452cf451815a3d2114c844a0ec86c83d5ffe3d5388d1f990b15f4af89e72eac7',
  '254fdaa2c03c3bdbdd5515b56fe2b9dc98be0e4a7f221cf5187efd72ca923c1c',
  'b4e27e05b221144261b762ddc728a7ce2ed627b5978b08efe945ed8d921679d7',
  'ff61a49a073b2e70f3303b0729c6cfed7522f90d937519a953d5532003fe078d',
  '8096be47dd1483d64ce92d6fcfd37e34f508b4c8f7eeb0c77445d745ff964071',
  '41e451dd3a994ebbeab676b1ff3ca69e6f8528ce40dc419d7a2c484e0f9fb549',
  '87cc055a05098e93e6c68a26a3006df9b02f2bb9f5d0e673a2518364a7d6c661',
  '335587ceb714710e35f2801158de474ff01f8a2111c59d888ff8ae9fd87db380',
  '7fe95d3903e9b45d7ed059dd580717148d9311404722491b411d32055c6d6af6',
  '616af6b26340f273f65a698d85eefa877f5c194605acac50b8940c54e247680a',
  '3270c2e5b4966fe8ca2a6a04aa8134118b65bc74bf14ca01a242ece3e79d6afa',
  '3635af656fe8589fb5e588143b4647ad3a20f149d8382bb46a01cf3c11a9341e',
  '47ab8ade35f64608c820c68f885cdddfdf536ab4d341ef3ff4b9125df91bd84a',
  'ba16069efdbc0ed0235c23389fdfed016e604c7602772d5b6e272d6f16161b3c',
  '702722d29cbc05e86f3680f2d62540693f4ec3b41e9aff4464b44f5d4f204798',
  'adb861e2c3c9346e716bd55c8f00a2bcc9062863ccaed17496a815f5c65fcfca',
  '1be48e6d8cb34dec098d86e979e4b3cef20e51339483b962ac4d745a00629e0a',
  'a42a3a1c3dce86f3ab90430f2f61dabfaf8311b8d0f7e35c882ac805cceb7e6f',
  '3d4eae434ed289825f7c76265e75a2bb383b1dad08f9112b011453f30f869c5a',
  '3ea2faf62e965b835097ba8f7d27963a64d7406b2e8c965c8d95006c956370a9',
  'd0dd858e95e772827830b18e326a66f5f2e8e7ee371e33cfe3169848c8125d85',
  'c80c2b834245fab7046346fa78f9ce043be567824a27dbdf346bb1a89b030a87',
  '84656305b20f3738785eaa8bb0319b7334ecb9843020c1997acc614127c6aa37',
  '5ea5d9164be364c3b5e25c5ca51eb4167ecdd0e47d924aab5ec3287855c8d608',
  '578b848f89b89c5b886770b3200129c04ad4bc05e5a062fc72d154fb5a7c7404',
  'c3ec192446c0a064bf80f9339d2f8dea850260a3004ba77da6b539a4c9185e7d',
  '986270e7644311d447589d22ebfa54ff9d557ee9539cb77c346191ef44c5d182',
  '8221af6ba45d27a33b9686634c423a6e6c41b2ccd50286221a1f8a2d2193caf6',
  'fb71f9d8ae3a5e91315877c32331b06bcb32951ac7a6a82155e4516ef6f2fc67',
  'e863565907d64aea7b1cfc88c596150f8ccd20de9b26c44bc779d0907c2fa4b0',
  'c34376a4f0faaa3dbdfe519af0dbff1bc4c9d896b7649dfd05d0e45f86ae14a0',
  '7b99ea1dc1c9f4ebfa9aa5c517766a858953e9f2d2f92fa723a86fb3de278d0d',
  '1d03852d114686e03a87aab030dccfc35d0e3ac1b06413b256b1d0fb0a4a843c',
  '95fa25df9f9886a5f9c21c631eb249826a56ed7ba95d75e8b066b3f5ee8bb862',
  'd1916ed1e0f5f8e360ff4a7a4c0e34cfeac7a930e80b2309bd943711e2c627dd',
  '4038023dd7b2d45c127a8b8b048010e239bc2c8b4790e201e5daf073268b834b',
  'a42b4f4540c3d187907190e8b643e865355443dcdaa99ebd7a3f9fb30930fe2e',
  '31f6817d291887a5c0cd45a69741aa34a7c3ae10da36f0dd0977899e2555922c',
  'fee41146979b4a106a5179122e7c8077c26291a38cc2b854e81e8e4fdd4b0bf3',
  '88d26b908aee6632479f7a0c29493189f3ef7cc33ba7a14876c9c19bcfa155f3',
  '68fd201330b468024429d0fb851a63727bb7680945c819a3f1655028e71eabec',
  '7846f1b59d6273c26b7a0ca2c6931adfdcd2b1e3bc07addfff75b985190161d7',
  '6e3898212017ee7f03dd9e44d4c24d10ba36c4d968a1666951eb7c1e1b571ad0',
  'e24098bcc17ae9d75c3e0e6dd2f5a71570b95bcd2dd7257fa69401ba0e779b5a',
  '63f7b8a71ab8f69b7ec6d2b2fde7e905bf6edde44597ef77e1ae61603266c544',
  'cbf16dfcd03a1ee3b910f6d4ef6201f90e2232f56750f14f0eead03171705fcd',
  'c528a5c0a71a9758448cd47ff47c13503ca18d59b91462f1c5eb8ea3239d876f',
  'badfa80b90cffe0813b2d74b4871635e7a15822f47f5e8f295a465f6db5050b5',
  'e9693ea522adc553ec0bcb50c58475f7f5192e75a6529446ec7fec8a679da5b3',
  '55003bfb02b0625937d0d121e07c0f664d22aea77d59556216aa80f09347d545',
  'a75eff2ff1418bf96f1034e2d8a1fd3bf5c8c1a5661cb9d0f8e6e8ac80733866',
  'f681f633aa8b11364783b39875c6f9cbbf253eed85c950ddc14ad6485e4af288',
  '048a5d4e4aee6debf7576254575e5be78353629a46fa99a7338735651c45a1e9',
  '88bd72e7fb63d151bcc21e729610e91c2016dec9e7e808c8abfa9d8366278008',
  '09a0a90f77354b12671ebfb6178b8c611511b57df93614b0c8960898642df4e2',
  '2e2e40f8d86aed56597554e2d2749da395ebd1d2f8de5207f96941a7e72c51f3',
  '95f709658d20edc1339998d58077e511038ec65fe0137b3d967945e364afdd8a',
  'a07c009bd3f8942aeb56b18ea63c2af7f15a84f8d354f408b7bdf289f882e3ce',
  'c3723b52a24cfaf0e8f97ff951305728e2d7b6d9f57741319c348eacd65bea23',
  'ba39a450535f4a000ccc078c86cf922e403e40feff39c3f8aa3623509fcf8a02',
  '418d0661549070e4d71c5339c092c4f4fa93109044f342e535774b5c2e998632',
  '5da64d0f073c560ed85bf0385a0ca73a35c472dd4330a1e14c621908b27adbfa',
];

let cache: null | { latest: boolean; serials: string[] } = null;

const getBlockedSerials = async (): Promise<{ latest: boolean; serials: string[] }> => {
  if (cache) {
    return cache;
  }

  try {
    const { data } = await axiosFluxId.get('/machine/blocked');
    const serials = data.blocked;

    if (serials !== undefined) {
      cache = { latest: true, serials };

      return cache;
    }
  } catch (e) {
    console.error('Error when getting blocked serials', e);
  }
  cache = { latest: false, serials: BLOCKED_SERIALS };

  return cache;
};

export const checkBlockedSerial = async (serial: string): Promise<boolean> => {
  if (Date.now() < new Date('2025/2/3 10:0:0 +8:00').valueOf()) {
    return true;
  }

  const hashedSerial = await sha256(serial);
  const { latest, serials } = await getBlockedSerials();
  const isBlocked = serials.includes(hashedSerial);

  if (!isBlocked) {
    return true;
  }

  alertCaller.popUp({
    caption: i18n.lang.message.device_blocked.caption,
    id: 'device-blocked',
    message: latest ? i18n.lang.message.device_blocked.online : i18n.lang.message.device_blocked.offline,
  });

  return false;
};
